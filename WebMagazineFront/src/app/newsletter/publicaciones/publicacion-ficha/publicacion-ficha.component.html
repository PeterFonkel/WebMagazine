<body id="publicacion">

    <!-- Publicacion -->
    <form action="" class="m-2">
        <!-- Titulo -->
        <div class="row m-3 titulo justify-content-center">
            <textarea *ngIf="publicacion" class="row text-titulo" type="text" name="titulo"
                [(ngModel)]="publicacion.titulo" placeholder="Titulo (*Obligatorio)" maxlength="130" (keyup)="analizarTitulo()"></textarea>
                <div class="recomendaciones">
                    <p class="titulo-recomendaciones"><b>Recomendaciones en título</b></p>
                    <p class="recomendacion-titulo">- Palabras recomendadas entre 10 y 15. Llevas: {{palabrasTitulo}}
                        <span *ngIf="palabrasTitulo<16 && palabrasTitulo>9">✅</span>
                        <span *ngIf="palabrasTitulo>16 || palabrasTitulo<10">❓</span>
                    </p>
                    <p *ngIf="palabrasRepetidasTitulo" class="recomendacion-titulo">- Las siguientes palabras se repiten mucho: {{palabrasRepetidasTitulo}}  ❓</p>
                </div>
      </div>

        <!-- Datos -->
        <div class="row">
            <div class="datos col-12 col-sm-5 mt-1">
                <h3 class="text-center">Datos</h3>
                <!-- Autor -->
                <div class="m-4 row row-dato">
                    <p class="col-3 m-1">Autor:</p>
                    <div *ngIf="publicacion.autor" class="col-6 m-2">
                        <select name="autorSeleccionado" id="autorSeleccionado" [(ngModel)]="publicacion.autor.id">
                            <option *ngFor="let autor of autores" value="{{autor.id}}">
                                {{autor.nombre}} {{autor.apellido1}} {{autor.apellido2}}</option>
                        </select>
                    </div>
                    <div class="col-2 texto-obligatorio"><p>*Obligatorio</p></div>
                </div>

                <!-- Lugar -->
                <div class="m-4 row row-dato">
                    <p class="col-3 m-1">Lugar:</p>
                    <div *ngIf="publicacion.lugar" class="col-6 m-2">
                        <select name="lugar" id="lugar" [(ngModel)]="publicacion.lugar.id">
                            <option *ngFor="let lugar of lugares" value="{{lugar.id}}">
                                {{lugar.lugarNombre}}</option>
                        </select>
                    </div>
                    <div class="col-2 texto-obligatorio"><p>*Obligatorio</p></div>
                </div>

                <!-- Categoria -->
                <div class="m-4 row row-dato">
                    <p class="col-3 m-1">Categoria:</p>
                    <div *ngIf="publicacion.categoria" class="col-6 m-2">
                        <select name="autor" id="categoria" [(ngModel)]="publicacion.categoria.id">
                            <!--  <option value="{{publicacion.categoria.id}}" selected disabled>
                                {{publicacion.categoria.categoriaNombre}}</option> -->
                            <option *ngFor="let categoria of categorias" value="{{categoria.id}}">
                                {{categoria.categoriaNombre}}</option>
                        </select>
                    </div>
                    <div class="col-2 texto-obligatorio"><p>*Obligatorio</p></div>
                </div>
                <!-- Tags -->
                <div class="m-4 row row-dato">
                    <div class="tags-container">
                        <!-- Boton agregar Tag -->
                        <div class="m-4 row justify-content-center">
                            <button class="btn btn-success boton-agregar-tag" data-bs-toggle="modal"
                                data-bs-target="#agregarTagModal">
                                Agregar tag
                            </button>
                        </div>
                        <!-- Tags agregadas -->
                        <div class="row justify-content-center row-tags">
                            <div *ngFor="let tag of tagsSeleccionadas" class="tag m-2 col-2">
                                <p class="tag-nombre px-2">{{tag.tagNombre}}</p>
                                <div class="boton-eliminar" (click)="eliminarTag(tag.id)">
                                    <img src="../../../../assets/x-eliminar.png" alt=""
                                        style="height: 1rem;width: 1rem;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Premiun y destacado -->
                <div class="m-4 row">
                    
                    <!-- Premium -->
                    <div class="col-4">
                        <label for="premium">Premium</label>
                        <input type="checkbox" name="premium" [(ngModel)]="publicacion.premium" class="m-1">
                    </div>

                    <!-- Destacado -->
                    <div class="col-4">
                        <label for="destacado">Destacado</label>
                        <input type="checkbox" name="destacado" [(ngModel)]="publicacion.destacado" class="m-1">
                    </div>

                    <!-- Carousel -->
                    <div class="col-4">
                        <label for="destacado">Carousel</label>
                        <input type="checkbox" name="carousel" [(ngModel)]="publicacion.carousel" class="m-1">
                    </div>
                </div>
            </div>

            <!-- Preview -->
            <div class="col-12 col-sm-6 mt-3 preview">
                <h3 class="text-center">Preview</h3>
                <div class="row align-items-center justify-content-center my-2">
                    <!-- Card publicacion -->
                    <div class="col-12 col-lg-6 publicacion-preview">
                        <div *ngIf="imagePreviewUrl" class="card-image">
                            <img src="{{imagePreviewUrl}}" class="img-card img-fluid w-100 my-2" alt=""
                                data-bs-toggle="modal" data-bs-target="#imagenPreviewModal">
                        </div>
                        <div *ngIf="!imagePreviewUrl" class="card-image">
                            <img src="../../../../assets/no-imagen.png" class="img-card img-fluid w-100 my-2" alt=""
                                data-bs-toggle="modal" data-bs-target="#imagenPreviewModal">
                        </div>
                        <div class="card-body">
                            <div style="display:block;">
                                <h5 class="card-title text-center m-1 " style="height:5vh;">
                                    <b>{{publicacion.titulo}}</b>
                                </h5>
                                <div class="card-text text-center">
                                    <textarea class="row text-descripcion mt-4 mb-2 mx-1" type="text" name="subtitulo"
                                        rows="3" maxlength="210" [(ngModel)]="publicacion.subtitulo"
                                        placeholder="Descripción de la publicación (para preview)" (keyup)="contarPalabrasDescripcion()"></textarea>
                                        <p class="row recomendacion-titulo mx-1">Recomendado entre 20 y 30 palabras. Llevas: {{palabrasDescripcion}}</p>
                                </div>
                                <div class="color-letra m-2">
                                    <label class="mx-2" for="colorLetra">Letra oscura sobre la imagen</label>
                                    <input type="checkbox" name="colorLetra" [(ngModel)]="publicacion.letraOscura">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <!-- Editor de texto -->
    <h3 class="text-center mt-4">Contenido de la publicación</h3>
    <div class="editor-container mx-3">
        <form class="m-1 agregar-bloque-texto row form-group text-center">
            <div class="row col-12 col-sm-1">
                <!-- Boton agregar Imagen -->
                <div class="col-4 col-sm-12">
                    <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#imagenModal">
                        <img class="icono-youtube" src="../../../../assets/icono-foto.png" alt="">
                    </button>
                </div>
                <!-- Boton agregar Video -->
                <div class="col-4 col-sm-12">
                    <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#videoModal">
                        <img class="icono-youtube" src="../../../../assets/icono-youtube.jpg" alt="">
                    </button>
                </div>
                <!-- Boton agregar Podcast -->
                <div class="col-4 col-sm-12">
                    <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#podcastModal">
                        <img class="icono-spotify" src="../../../../assets/icono-spotify.png" alt="">
                    </button>
                </div>
                <!-- Boton importar WordPress -->
                <div class="col-4 col-sm-12">
                    <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#importarModal">
                        <img class="icono-spotify" src="../../../../assets/icono-importar.png" alt="">
                    </button>
                </div>
            </div>

            <!-- Editor de texto Quill-->
            <div class="col-11 editor-container" id="editor">
                <quill-editor class="quill-editor my-2 py-4" [(ngModel)]="texto" name="editor"
                    id="editor"></quill-editor>
            </div>
        </form>
    </div>

    <!-- Boton Publicar -->
    <div class="row text-center m-4">
        <div class="col-2"></div>
        <div class="col-4 text-center">
            <button *ngIf="publicacion.fechaPublicacion!=''" type="button" class="btn btn-success" (click)="publicarModificada()">
                Publicar
            </button>
            <button *ngIf="publicacion.fechaPublicacion==''"  type="button" class="btn btn-success" (click)="publicarNueva()">
                Publicar
            </button>
        </div>
        <div class="col-4 text-center">
            <button *ngIf="publicacion.fechaPublicacion!=''" type="button" class="btn btn-warning" (click)="guardarBorradorModificado()">
                Guardar como borrador (no publicado)
            </button>
            <button *ngIf="publicacion.fechaPublicacion==''" type="button" class="btn btn-warning" (click)="guardarBorradorNuevo()">
                Guardar borrador
            </button>
        </div>
    </div>
</body>

<!-- Modal Agregar Podcast-->
<div class="modal fade" id="podcastModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Insertar Podcast</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="text" name="" style="width: 95%" placeholder="Url del podcast Spotify" rows=1
                    [(ngModel)]="htmlPodcast">
                <img class="img-fluid my-4" src="../../../../assets/copiar_codigo_spotify.png" alt="">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button class="btn btn-primary" (click)="agregarPodcast()" data-bs-dismiss="modal">Añadir
                    podcast</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Agregar Video-->
<div class="modal fade" id="videoModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Insertar Video</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="text" name="" style="width: 95%" placeholder="Url del video de Youtube" rows=1
                    [(ngModel)]="htmlVideo">
                <img class="img-fluid my-4" src="../../../../assets/copiar_codigo_youtube.png" alt="">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button class="btn btn-primary" (click)="agregarVideo()" data-bs-dismiss="modal">Añadir
                    video</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Agregar Imagen al contenido de la publicacion-->
<div class="modal fade" id="imagenModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Insertar Imagen</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <section class="my-2">
                    <input type="file" accept="images/" (change)="onSelectFile($event)">
                </section>
                <section *ngIf="imageUrl">
                    <angular-cropper [imageUrl]="imageUrl" #angularCropper></angular-cropper>
                </section>
                <section class="my-4">
                    <label for="" class="mx-2">Tamaño</label>
                    <select type="text" [(ngModel)]="anchoImagen">
                        <option value="100">Ancho 100%</option>
                        <option value="75">Ancho 75%</option>
                        <option value="50">Ancho 50%</option>
                        <option value="35">Ancho 35%</option>
                        <option value="20">Ancho 20%</option>
                    </select>
                </section>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button class="btn btn-primary" (click)="getCroppedImage()" data-bs-dismiss="modal">Aceptar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Agregar Imagen Autor al contenido de la publicacion-->
<div class="modal fade" id="imagenAutorModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Insertar Imagen</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <section>
                    <input type="file" accept="images/" (change)="onSelectFile($event)">
                </section>
                <section *ngIf="imageUrl">
                    <!--   <angular-cropper [imageUrl]="imageUrl" #angularCropper></angular-cropper> -->
                </section>
                <section class="my-4">
                    <label for="" class="mx-2">Tamaño</label>
                    <select type="text" [(ngModel)]="anchoImagen">
                        <option value="100">Ancho 100%</option>
                        <option value="75">Ancho 75%</option>
                        <option value="50">Ancho 50%</option>
                        <option value="35">Ancho 35%</option>
                    </select>
                </section>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button class="btn btn-primary" data-bs-dismiss="modal">Aceptar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Agregar Imagen de preview-->
<div class="modal fade" id="imagenPreviewModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Insertar Imagen</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <section class="my-2">
                    <input type="file" accept="images/" (change)="onSelectFilePreview($event)">
                </section>
                <section *ngIf="imagePreviewUrl">
                    <angular-cropper [cropperOptions]='{aspectRatio: 3 / 2}' [imageUrl]="imagePreviewUrl"
                        #angularCropper2></angular-cropper>
                </section>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button class="btn btn-primary" (click)="getCroppedImagePreview()"
                    data-bs-dismiss="modal">Aceptar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Agregar Tag-->
<div class="modal fade" id="agregarTagModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Insertar tag</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row tag-existente-container">
                    <label for="" class="mx-2 col-3">Seleccionar tag existente</label>
                    <select class="col-6" name="tag4" id="tg4" [(ngModel)]="tagSeleccionada.id">
                        <option *ngFor="let tag of tags" value={{tag.id}}>{{tag.tagNombre}}</option>
                    </select>
                    <button class="col-2 btn btn-primary m-1" (click)="agregarTag()"
                        data-bs-dismiss="modal">Agregar</button>
                </div>
                <hr>
                <div class="row nueva-tag-container">
                    <label class="col-3 mx-2" for="titulo">Escribir nueva </label>
                    <input class="col-6" type="text" name="tagNueva" [(ngModel)]="tagNueva.tagNombre">
                    <button class="col-2 btn btn-primary m-1" (click)="nuevaTag()"
                        data-bs-dismiss="modal">Crear</button>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- Modal Error-->
<div class="modal fade" id="errorModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="staticBackdropLabel">Error al enviar</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p><b>Error al crear publicación. Revise lo siguiente:</b></p>
          <p *ngIf="publicacion.titulo ==''">El título no puede estar vacío.</p>
          <p *ngIf="publicacion.autor.id==''">Debe seleccionar un autor.</p>
          <p *ngIf="publicacion.imagenPreviewUrl==''">Debe seleccionar una imagen para la preview.</p>
          <p *ngIf="publicacion.subtitulo==''">El texto de la preview no puede estar vacío.</p>
          <p *ngIf="texto==''">La publicacion no puede estar vacía.</p>
          <p *ngIf="publicacion.categoria.id==''">Debe seleccionar una categoría.</p>
          <p *ngIf="publicacion.lugar.id==''">Debe seleccionar un lugar.</p>
          <p *ngIf="!tituloValido">El título no puede contener los caracteres -, !, $, &, \, (, ), *, +, ',', ;, =, :, /, ?, #, [, ], %</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Enviado-->
<div class="modal fade" id="enviadoModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="staticBackdropLabel">Publicación enviada</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Publicación enviada.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary"  data-bs-dismiss="modal">Aceptar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Importar-->
  <div class="modal fade" id="importarModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="staticBackdropLabel">Importar de WordPress</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div class="fecha-container my-2">
                <label for="">Fecha de creacion del articulo a importar: </label>
                <input class="mx-2" type="date" [(ngModel)]="fechaArticuloImportado">
            </div>
            <div class="codigo-importar-container">
                <label for="">Pega aquí el código html de la etiqueta main del articulo.</label>
                <textarea name="" id="" cols="52" rows="20" [(ngModel)]="htmlWordPress"></textarea>
            </div>
            
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary"  data-bs-dismiss="modal" (click)="importar()">Importar</button>
        </div>
      </div>
    </div>
  </div>

  
